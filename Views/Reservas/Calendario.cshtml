@model Reservas.Models.CalendarioViewModel
@using System.Text.Json


@{
    ViewData["Title"] = "Calendario de Reservas";
}

<!-- FullCalendar CSS -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet" />

<!-- FullCalendar JS y Plugins -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/daygrid.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/timegrid.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/list.min.js"></script>


<div class="row">
    <div class="col-md-3">
        <h5>Recursos</h5>
        <ul class="list-group">
            @foreach (var recurso in Model.Recursos.GroupBy(r => r.Id).Select(g => g.First()))
            {
                <li class="list-group-item">
                    <strong>@recurso.Center.NameSpanish</strong><br />
                    @recurso.ResourceType.NameSpanish - @recurso.NameSpanish
                </li>
            }
        </ul>
    </div>

   <div class="col-md-9">
    <div id="main-calendar"></div>
</div>

</div>
<style>
    #main-calendar {
        min-height: 600px;
    }
</style>


@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('main-calendar');

            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'timeGridWeek',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
                },
                locale: 'es', // para español
                firstDay: 1, // lunes
                slotMinTime: "07:00:00",
                slotMaxTime: "22:00:00",
                @using System.Text.Json

events: @Html.Raw(JsonSerializer.Serialize(
    Model.Reservas.Select(reserva => new {
        title = reserva.Resource?.NameSpanish,
        start = reserva.FechaInicio.ToString("s"),
        end = reserva.FechaFin.ToString("s"),
        color = reserva.Estado == "Confirmada" ? "green" :
                reserva.Estado == "Pendiente" ? "orange" : "red"
    })
))

            }
        ]

))

            });

            calendar.render();
        });
    </script>
}
